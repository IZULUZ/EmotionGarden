<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë§ˆìŒë°­ ê´€ë¦¬ì</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body style="background:#EEF2F3;">
    <header style="background:var(--green); color:white; padding:20px; text-align:center;">
        <h2>[ì„ ìƒë‹˜ ëª¨ë“œ] ìš°ë¦¬ ë°˜ ë§ˆìŒë°­ í˜„í™©</h2>
    </header>
    <div id="admin-grid" style="display:grid; grid-template-columns:repeat(auto-fill, minmax(250px, 1fr)); gap:20px; padding:20px;"></div>

    <script>
        firebase.initializeApp(firebaseConfig); // ìœ„ì™€ ë™ì¼ ì„¤ì •
        const db = firebase.database();

        db.ref('students').on('value', (snap) => {
            const grid = document.getElementById('admin-grid');
            grid.innerHTML = '';
            snap.forEach(child => {
                const s = child.val();
                const card = document.createElement('div');
                card.style = "background:white; padding:20px; border-radius:20px; box-shadow:0 4px 10px rgba(0,0,0,0.1)";
                card.innerHTML = `
                    <h3>${child.key} (LV.${s.lv})</h3>
                    <div style="font-size:40px; text-align:center;">${s.finalEmoji || 'ğŸŒ±'}</div>
                    <p><b>íƒœê·¸:</b> ${s.tags}</p>
                    <p><b>ì¼ê¸°:</b> ${s.diary}</p>
                    <hr>
                    <div id="quest-${child.key}"></div>
                `;
                grid.appendChild(card);
                
                // í•™ìƒì´ 'ë‹¤í–ˆì–´ìš”'ë¥¼ ëˆŒë €ì„ ë•Œ ìŠ¹ì¸ ë²„íŠ¼ ë…¸ì¶œ
                if(s.pendingQuests) {
                    Object.keys(s.pendingQuests).forEach(qKey => {
                        const btn = document.createElement('button');
                        btn.innerText = "ìŠ¹ì¸: " + s.pendingQuests[qKey].title;
                        btn.style = "background:orange; color:white; border-radius:10px; padding:5px; margin-top:5px; width:100%";
                        btn.onclick = () => {
                            db.ref(`students/${child.key}/points`).transaction(p => (p||0) + 10);
                            db.ref(`students/${child.key}/pendingQuests/${qKey}`).remove();
                            alert("ìŠ¹ì¸ ì™„ë£Œ! í¬ì¸íŠ¸ê°€ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤.");
                        };
                        document.getElementById(`quest-${child.key}`).appendChild(btn);
                    });
                }
            });
        });
    </script>
</body>
</html>
