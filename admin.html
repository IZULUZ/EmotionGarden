<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë§ˆìŒë°­ ê´€ë¦¬ì</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body style="background: #eef2f3;">
    <header><h2>ì„ ìƒë‹˜ ëª¨ë“œ: ìš°ë¦¬ ë°˜ ë§ˆìŒë°­ ê´€ë¦¬</h2></header>
    <div id="admin-grid" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap:20px; padding:20px;"></div>

    <script>
        // Firebase ì„¤ì • (ìœ„ì™€ ë™ì¼)
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        db.ref('students').on('value', (snap) => {
            const grid = document.getElementById('admin-grid');
            grid.innerHTML = '';
            snap.forEach(child => {
                const s = child.val();
                const card = document.createElement('div');
                card.className = "student-card";
                card.style = "background:white; padding:20px; border-radius:15px; border-left: 5px solid " + (s.status==='recorded'?'#a8d5ba':'#ddd');
                card.innerHTML = `
                    <h3>${child.key}</h3>
                    <div style="font-size:30px">${s.emoji || 'ğŸŒ±'}</div>
                    <p style="color:#666">${s.tags || ''}</p>
                    <hr>
                    <div id="noti-${child.key}"></div>
                `;
                grid.appendChild(card);
                
                if(s.notifications) {
                    Object.keys(s.notifications).forEach(nk => {
                        const n = s.notifications[nk];
                        const btn = document.createElement('button');
                        btn.innerText = "ìŠ¹ì¸: " + n.title;
                        btn.onclick = () => {
                            db.ref(`students/${child.key}/points`).transaction(p => (p||0)+10);
                            db.ref(`students/${child.key}/notifications/${nk}`).remove();
                            alert("í¬ì¸íŠ¸ë¥¼ ì§€ê¸‰í–ˆìŠµë‹ˆë‹¤!");
                        };
                        document.getElementById(`noti-${child.key}`).appendChild(btn);
                    });
                }
            });
        });
    </script>
</body>
</html>
