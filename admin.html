<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Emotion Garden - êµì‚¬ìš© ëŒ€ì‹œë³´ë“œ</title>
    <link href="https://fonts.googleapis.com/css2?family=DungGeunMo&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root {
            --pixel-brown: #634d31;
            --pixel-gold: #f7d031;
            --pixel-green: #3fb158;
            --pixel-bg: #e5d3b3;
        }

        body {
            font-family: 'DungGeunMo', sans-serif;
            background: var(--pixel-bg);
            margin: 0;
            padding: 20px;
            color: var(--pixel-brown);
        }

        /* í—¤ë” ë””ìì¸ */
        .admin-header {
            background: var(--pixel-brown);
            color: white;
            padding: 20px;
            border: 4px solid var(--pixel-gold);
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
        }

        .admin-header h1 { margin: 0; font-size: 2.5rem; text-shadow: 2px 2px 0px #000; }

        /* í•™ìƒ ì¹´ë“œ ê·¸ë¦¬ë“œ */
        .admin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
        }

        /* ìŠ¤íƒ€ë“€ë°¸ë¦¬ í’ í•™ìƒ ì¹´ë“œ [cite: 5, 20] */
        .student-card {
            background: #fff8e1;
            border: 6px solid var(--pixel-brown);
            padding: 20px;
            position: relative;
            transition: transform 0.2s;
        }

        .student-card:hover { transform: scale(1.02); }

        .student-card.recorded { border-color: var(--pixel-green); }

        .st-info { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .st-lv { background: var(--pixel-green); color: white; padding: 2px 10px; font-size: 14px; }

        .emoji-view { font-size: 60px; text-align: center; margin: 15px 0; background: #fff; border: 2px dashed var(--pixel-brown); border-radius: 10px; }

        .diary-preview {
            background: #fdfdfd;
            border-left: 4px solid var(--pixel-gold);
            padding: 10px;
            font-size: 14px;
            height: 60px;
            overflow-y: auto;
            margin-bottom: 10px;
        }

        /* ìŠ¹ì¸ ë²„íŠ¼  */
        .btn-approve {
            width: 100%;
            font-family: 'DungGeunMo';
            background: var(--pixel-gold);
            border: 4px solid var(--pixel-brown);
            padding: 10px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: inset -4px -4px 0px #b59000;
        }

        .btn-approve:active { box-shadow: none; transform: translate(2px, 2px); }

        .btn-back {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 25px;
            background: var(--pixel-brown);
            color: white;
            text-decoration: none;
            border: 4px solid var(--pixel-gold);
        }
    </style>
</head>
<body>

    <div class="admin-header">
        <h1>ğŸŒ± ë§ˆìŒ ì •ì› ê´€ë¦¬ì ëª¨ë“œ</h1>
        <p>ìš°ë¦¬ ë°˜ ì¹œêµ¬ë“¤ì˜ ì„±ì¥ê³¼ ê°ì •ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ë³´ì‚´í´ì£¼ì„¸ìš”.</p>
    </div>

    <div id="admin-grid" class="admin-grid">
        </div>

    <a href="index.html" class="btn-back">ì •ì›ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>

    <script>
        // index.htmlê³¼ ë™ì¼í•œ Firebase ì„¤ì •
        const firebaseConfig = {
            apiKey: "AIzaSyDw773x1yot2uncAMl_gTQ6z6Njhgh1Od8",
            authDomain: "secret-quest-class.firebaseapp.com",
            databaseURL: "https://secret-quest-class-default-rtdb.firebaseio.com",
            projectId: "secret-quest-class",
            storageBucket: "secret-quest-class.firebasestorage.app",
            messagingSenderId: "397245266210",
            appId: "1:397245266210:web:fde35d6a4dfd6ca7070d7b"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // ì‹¤ì‹œê°„ í•™ìƒ ë°ì´í„° ê°ì‹œ (PDF Page 2-5 ë°ì´í„° ì—°ë™) [cite: 5, 22]
        db.ref('students').on('value', (snapshot) => {
            const grid = document.getElementById('admin-grid');
            grid.innerHTML = ''; 

            snapshot.forEach((child) => {
                const s = child.val();
                const stId = child.key;

                const card = document.createElement('div');
                card.className = `student-card ${s.tempTags ? 'recorded' : ''}`;
                
                card.innerHTML = `
                    <div class="st-info">
                        <span style="font-size:1.2rem; font-weight:bold;">${stId}</span>
                        <span class="st-lv">LV.${s.lv || 1}</span>
                    </div>
                    <div class="emoji-view">${s.emoji && s.emoji.length > 0 ? 'âœ¨' : 'ğŸŒ±'}</div>
                    <div style="color:var(--pixel-green); margin-bottom:5px;">${s.tempTags || '#ì•„ì§ê¸°ë¡ì „'}</div>
                    <div class="diary-preview">${s.tempDiary || 'í•™ìƒì´ ì¼ê¸°ë¥¼ ì‘ì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...'}</div>
                    
                    <div style="font-size:12px; margin-bottom:10px;">
                        ğŸ’©${s.stats?.fert||0}% | ğŸ’§${s.stats?.water||0}% | ğŸ’Š${s.stats?.nutr||0}% | ğŸ’°${s.points||0}G
                    </div>

                    <div id="quest-area-${stId}"></div>
                `;
                grid.appendChild(card);

                // í€˜ìŠ¤íŠ¸ ìŠ¹ì¸ ëŒ€ê¸° ìƒíƒœ í™•ì¸ (í•™ìƒì´ 'ë‹¤í–ˆì–´ìš”!'ë¥¼ ëˆ„ë¥¼ ê²½ìš°) 
                if (s.notifications) {
                    Object.keys(s.notifications).forEach(nKey => {
                        const noti = s.notifications[nKey];
                        const btn = document.createElement('button');
                        btn.className = 'btn-approve';
                        btn.innerText = `âœ”ï¸ ìŠ¹ì¸: ${noti.title}`;
                        btn.onclick = () => approveQuest(stId, nKey);
                        document.getElementById(`quest-area-${stId}`).appendChild(btn);
                    });
                }
            });
        });

        // í€˜ìŠ¤íŠ¸ ìŠ¹ì¸ ë° í¬ì¸íŠ¸ ì§€ê¸‰ ë¡œì§
        function approveQuest(stId, nKey) {
            // 1. í¬ì¸íŠ¸ 10G ì§€ê¸‰
            db.ref(`students/${stId}/points`).transaction((current) => (current || 0) + 10);
            // 2. ì•Œë¦¼ ì‚­ì œ
            db.ref(`students/${stId}/notifications/${nKey}`).remove();
            alert(`${stId} í•™ìƒì˜ ë…¸ë ¥ì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤! 10Gë¥¼ ë³´ëƒˆì–´ìš”.`);
        }
    </script>
</body>
</html>
